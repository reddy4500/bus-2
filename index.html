<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Yaswanth Fleet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --bg-color: #f4f7fe;
            --primary-color: #4f46e5;
            --primary-color-light: #e0e7ff;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --border-color: rgba(255, 255, 255, 0.5);
            --shadow-color: rgba(71, 85, 105, 0.1);
            --success: #22c55e; --error: #ef4444;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            overflow-x: hidden;
        }
        /* Aurora Background */
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background-image: radial-gradient(circle, rgba(165, 180, 252, 0.5) 0%, rgba(244, 247, 254, 0) 40%),
                              radial-gradient(circle, rgba(199, 210, 254, 0.5) 0%, rgba(244, 247, 254, 0) 40%);
            background-repeat: no-repeat; z-index: -1;
            animation: aurora 20s linear infinite;
        }
        @keyframes aurora {
            0%, 100% { background-position: 10% 20%, 80% 90%; }
            50% { background-position: 90% 80%, 20% 10%; }
        }

        /* Page Transitions */
        .page { display: none; opacity: 0; transition: opacity 0.3s ease-in-out; }
        .page.active { display: block; opacity: 1; }
        
        /* Glassmorphism & UI Elements */
        .glass-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px 0 var(--shadow-color);
        }
        .yaswanth-title {
            background: linear-gradient(to right, #6366f1, #a855f7, #ec4899);
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        .nav-link.active { color: var(--primary-color); font-weight: 600; }
        [contenteditable=true]:focus { background-color: white; box-shadow: 0 0 0 2px var(--primary-color); }

        /* Modals, Toasts, Skeletons */
        .modal-overlay { background-color: rgba(0,0,0,0.5); animation: fadeIn 0.3s ease; }
        .modal-content { animation: slideUp 0.4s ease-out; }
        .toast { animation: slideInToast 0.3s ease, fadeOutToast 0.5s ease 3.5s forwards; }
        .skeleton { background-color: #e2e8f0; border-radius: 0.25rem; animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInToast { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOutToast { from { opacity: 1; } to { opacity: 0; transform: translateY(-20px); height: 0; padding: 0; margin: 0;} }
        @keyframes pulse { 50% { opacity: .5; } }

        /* Responsive Table Cards */
        @media (max-width: 768px) {
            .responsive-table thead, .responsive-table tfoot { display: none; }
            .responsive-table tr { 
                display: block; margin-bottom: 1rem; border: 1px solid #e5e7eb;
                border-radius: 0.75rem; padding: 1rem; background-color: white;
                box-shadow: 0 2px 4px var(--shadow-color);
            }
            .responsive-table td {
                display: flex; justify-content: space-between; align-items: center;
                padding: 0.5rem 0; border: none; text-align: right;
            }
            .responsive-table td::before {
                content: attr(data-label); font-weight: 600;
                color: var(--text-light); margin-right: 1rem; text-align: left;
            }
            .responsive-table td.action-cell { justify-content: center; padding-top: 1rem; }
        }
        /* Diesel table cross-hair highlighting */
        #diesel-table .highlight-row, #diesel-table .highlight-col { background-color: var(--primary-color-light) !important; }
        #diesel-table .highlight-row .sticky, #diesel-table .highlight-col .sticky { background-color: #c7d2fe !important; }
    </style>
</head>
<body class="antialiased">

    <div id="app-container" class="min-h-screen">
        <header id="app-header" class="glass-card flex justify-between items-center fixed top-4 left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] max-w-7xl z-50 p-4 rounded-xl shadow-md"></header>
        <main id="app-main" class="pt-28 container mx-auto p-4 md:p-8 max-w-7xl"></main>
        <footer class="text-center mt-8 pb-8 text-slate-500 text-sm">
            <p>&copy; <span id="current-year"></span> Yaswanth Fleet Management. All Rights Reserved.</p>
        </footer>
    </div>
    
    <div id="modal-container"></div>
    <div id="toast-container" class="fixed top-5 right-5 z-[9999] flex flex-col gap-3"></div>

    <template id="header-template">
        <a href="#home" class="flex items-center gap-2">
            <h1 class="text-3xl md:text-4xl font-extrabold yaswanth-title">Yaswanth</h1>
        </a>
        <nav id="desktop-nav" class="hidden md:flex space-x-8">
            <a href="#home" data-nav="home" class="nav-link text-slate-600 hover:text-indigo-500 font-medium transition-colors">Home</a>
            <a href="#audit" data-nav="audit" class="nav-link text-slate-600 hover:text-indigo-500 font-medium transition-colors">Audit</a>
            <a href="#diesel" data-nav="diesel" class="nav-link text-slate-600 hover:text-indigo-500 font-medium transition-colors">Diesel</a>
            <a href="#payroll" data-nav="payroll" class="nav-link text-slate-600 hover:text-indigo-500 font-medium transition-colors">Payroll</a>
            <a href="#reports" data-nav="reports" class="nav-link text-slate-600 hover:text-indigo-500 font-medium transition-colors">Reports</a>
        </nav>
        </template>

    <template id="dashboard-page-template">
        <div class="page" id="home-page">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-2 text-slate-900">Dashboard</h2>
                <p class="text-slate-500 text-lg">Select an option to begin.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8"></div>
        </div>
    </template>
    
    <template id="month-selection-page-template">
        <div class="page" id="month-selection-page">
            <div class="flex items-center mb-8">
                <a href="#home" class="back-button flex items-center font-medium transition-colors mr-6">
                    <svg class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    Back
                </a>
                <h2 class="page-title text-3xl font-bold text-slate-900"></h2>
            </div>
            <div class="month-selector grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
        </div>
    </template>

    <template id="data-table-page-template">
         <div class="page" id="data-table-page">
             <div class="controls-header"></div>
             <div class="table-container overflow-auto rounded-lg border glass-card max-h-[65vh]">
                <table class="min-w-full">
                    <thead class="bg-slate-100/80 sticky top-0 z-10"></thead>
                    <tbody class="bg-white/50 divide-y divide-slate-200"></tbody>
                    <tfoot class="bg-slate-200/80 font-bold sticky bottom-0"></tfoot>
                </table>
            </div>
         </div>
    </template>

    <template id="skeleton-table-template">
        <tr><td class="p-4" colspan="100%"><div class="space-y-3">
            <div class="grid grid-cols-3 gap-4"><div class="skeleton h-4 col-span-1"></div><div class="skeleton h-4 col-span-2"></div></div>
            <div class="skeleton h-4"></div>
        </div></td></tr>
        <tr><td class="p-4" colspan="100%"><div class="space-y-3">
            <div class="grid grid-cols-3 gap-4"><div class="skeleton h-4 col-span-2"></div><div class="skeleton h-4 col-span-1"></div></div>
            <div class="skeleton h-4"></div>
        </div></td></tr>
    </template>

    <script>
        const App = {
            state: { currentPage: null, currentMonth: null, currentYear: new Date().getFullYear(), currentModule: null, cache: {} },
            config: {
                busNumbers: ['9721', '9722', '9932', '9935', '9937', '9938', '4680', '4681', '4319', '4320'],
                months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
                firebaseConfig: {
                    apiKey: "AIzaSyBQrSN31bs0dqpyZVT_IeGktPEy7rMrqcQ",
                    authDomain: "yaswanth-fleet.firebaseapp.com",
                    databaseURL: "https://yaswanth-fleet-default-rtdb.firebaseio.com",
                }
            },

            init() {
                firebase.initializeApp(this.config.firebaseConfig);
                this.db = firebase.database();
                this.elements = {
                    header: document.getElementById('app-header'),
                    main: document.getElementById('app-main'),
                    modalContainer: document.getElementById('modal-container'),
                    toastContainer: document.getElementById('toast-container'),
                };
                this.elements.header.innerHTML = document.getElementById('header-template').innerHTML;
                document.getElementById('current-year').textContent = this.state.currentYear;
                
                this.router();
                window.addEventListener('hashchange', () => this.router());
            },
            
            async router() {
                const rawHash = window.location.hash.slice(1) || 'home';
                const [page, month] = rawHash.split('/');
                
                if (this.state.currentPage === page && this.state.currentMonth === month) return;

                const activePage = this.elements.main.querySelector('.page.active');
                if (activePage) activePage.classList.remove('active');
                
                await this.utils.sleep(150);
                this.elements.main.innerHTML = '';
                
                this.state.currentPage = page;
                this.state.currentMonth = month;
                this.updateNavLinks();

                const renderers = {
                    home: this.renderDashboard,
                    audit: month ? this.renderAuditTable : this.renderMonthSelection,
                    diesel: month ? this.renderDieselTable : this.renderMonthSelection,
                    payroll: month ? this.renderPayrollTable : this.renderMonthSelection,
                    reports: this.renderReportsPage
                };

                (renderers[page] || renderers['home']).call(this, month || page);
            },

            renderDashboard() {
                document.title = "Dashboard | Yaswanth Fleet";
                const page = this.utils.cloneTemplate('dashboard-page-template');
                const cardContainer = page.querySelector('.grid');
                // Dashboard cards configuration
                const cards = [
                    { title: 'Monthly Audit', text: 'Enter financial profit and loss data.', icon: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z', color: 'indigo', link: '#audit' },
                    { title: 'Diesel Audit', text: 'Track daily diesel consumption.', icon: 'M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10s5 2 5 2a8 8 0 013.657 6.657zM9.999 11.999a1 1 0 100-2 1 1 0 000 2z', color: 'purple', link: '#diesel' },
                    { title: 'Payroll', text: 'Calculate and manage driver payments.', icon: 'M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z', color: 'amber', link: '#payroll' },
                    { title: 'Fleet Reports', text: 'Analyze aggregated financial data.', icon: 'M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z', color: 'teal', link: '#reports' },
                ];
                cardContainer.innerHTML = cards.map(c => this.templates.dashboardCard(c)).join('');
                this.elements.main.appendChild(page);
                page.classList.add('active');
            },

            renderMonthSelection(module) {
                // ... Implementation would be similar to renderDashboard, using templates
                this.elements.main.innerHTML = `<div class="page active text-center p-8">Month selection for ${module} would be rendered here.</div>`;
            },
            
            async renderAuditTable(month) {
                // This is a placeholder for the full audit table rendering logic
                this.elements.main.innerHTML = `<div class="page active text-center p-8">Audit table for ${month} would be rendered here.</div>`;
            },
            
            async renderDieselTable(month) {
                // Placeholder
                this.elements.main.innerHTML = `<div class="page active text-center p-8">Diesel table for ${month} would be rendered here.</div>`;
            },

            async renderPayrollTable(month) {
                // Placeholder
                this.elements.main.innerHTML = `<div class="page active text-center p-8">Payroll table for ${month} would be rendered here.</div>`;
            },
            
            async renderReportsPage() {
                // Placeholder
                this.elements.main.innerHTML = `<div class="page active text-center p-8">Reports page would be rendered here.</div>`;
            },
            
            updateNavLinks() {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.toggle('active', link.dataset.nav === this.state.currentPage);
                });
            },

            // --- TEMPLATE GENERATORS ---
            templates: {
                dashboardCard({ link, color, icon, title, text }) {
                    return `
                    <a href="${link}" class="group glass-card p-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 block">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-${color}-100 text-${color}-600 mb-6 group-hover:bg-${color}-600 group-hover:text-white transition-colors">
                            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="${icon}" /></svg>
                        </div>
                        <h3 class="text-2xl font-semibold mb-3 text-slate-800">${title}</h3>
                        <p class="text-slate-500 mb-6">${text}</p>
                        <span class="font-semibold text-${color}-600 group-hover:underline">View Section &rarr;</span>
                    </a>`;
                }
            },

            // --- UTILITIES ---
            utils: {
                sleep: ms => new Promise(resolve => setTimeout(resolve, ms)),
                capitalize: s => s && s[0].toUpperCase() + s.slice(1),
                cloneTemplate: id => document.getElementById(id).content.cloneNode(true).firstElementChild,
                getModuleColor: module => ({ audit: 'indigo', diesel: 'purple', payroll: 'amber', reports: 'teal' }[module] || 'slate'),
                highlightCurrentMonth: container => {
                    const monthName = App.config.months[new Date().getMonth()];
                    container.querySelector(`a:nth-child(${new Date().getMonth() + 1})`)?.classList.add('current-month');
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
