<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Yaswanth Fleet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --bg-color: #f4f7fe; --primary-color: #4f46e5; --primary-color-light: #e0e7ff;
            --text-dark: #1e293b; --text-light: #64748b; --border-color: rgba(255, 255, 255, 0.5);
            --shadow-color: rgba(71, 85, 105, 0.1); --success: #22c55e; --error: #ef4444;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--bg-color);
            color: var(--text-dark); overflow-x: hidden;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background-image: radial-gradient(circle, rgba(165, 180, 252, 0.5) 0%, rgba(244, 247, 254, 0) 40%),
                              radial-gradient(circle, rgba(199, 210, 254, 0.5) 0%, rgba(244, 247, 254, 0) 40%);
            background-repeat: no-repeat; z-index: -1; animation: aurora 20s linear infinite;
        }
        @keyframes aurora {
            0%, 100% { background-position: 10% 20%, 80% 90%; }
            50% { background-position: 90% 80%, 20% 10%; }
        }

        .page { display: none; animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px); border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px 0 var(--shadow-color);
        }
        .yaswanth-title {
            background: linear-gradient(to right, #6366f1, #a855f7, #ec4899);
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        .nav-link.active { color: var(--primary-color); font-weight: 600; }
        [contenteditable=true] {
            outline: none; background-color: rgba(239, 246, 255, 0.5); padding: 2px 4px;
            border-radius: 4px; transition: all 0.2s ease-in-out;
        }
        [contenteditable=true]:hover { background-color: rgba(224, 231, 255, 0.7); }
        [contenteditable=true]:focus { background-color: white; box-shadow: 0 0 0 2px var(--primary-color); }
        [contenteditable=true]:empty:before { content: attr(data-placeholder); color: #94a3b8; font-style: italic; }

        .modal-overlay { background-color: rgba(0,0,0,0.5); animation: fadeInModal 0.3s ease; }
        .modal-content { animation: slideUpModal 0.4s ease-out; }
        .toast { animation: slideInToast 0.3s ease, fadeOutToast 0.5s ease 3.5s forwards; }
        .skeleton { background-color: #e2e8f0; border-radius: 0.25rem; animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUpModal { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInToast { from { transform: translateX(100%); opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOutToast { from { opacity: 1; } to { opacity: 0; transform: translateY(-20px); height: 0; padding: 0; margin: 0;} }
        @keyframes pulse { 50% { opacity: .5; } }

        @media (max-width: 768px) {
            .responsive-table thead, .responsive-table tfoot { display: none; }
            .responsive-table tr { 
                display: block; margin-bottom: 1rem; border: 1px solid #e5e7eb;
                border-radius: 0.75rem; padding: 1rem; background-color: white;
                box-shadow: 0 2px 4px var(--shadow-color);
            }
            .responsive-table td {
                display: flex; justify-content: space-between; align-items: center;
                padding: 0.5rem 0; border: none; text-align: right;
            }
            .responsive-table td::before {
                content: attr(data-label); font-weight: 600;
                color: var(--text-light); margin-right: 1rem; text-align: left;
            }
            .responsive-table td.action-cell { justify-content: center; padding-top: 1rem; }
        }
        #diesel-table .highlight-row, #diesel-table .highlight-col { background-color: var(--primary-color-light) !important; }
        #diesel-table .highlight-row .sticky, #diesel-table .highlight-col .sticky { background-color: #c7d2fe !important; }
    </style>
</head>
<body class="antialiased">

    <div id="modal-container"></div>
    <div id="toast-container" class="fixed top-5 right-5 z-[9999] flex flex-col gap-3"></div>
    
    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="glass-card flex justify-between items-center fixed top-4 left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] max-w-7xl z-50 p-4 rounded-xl shadow-md">
            <a href="#" onclick="showPage('home')" class="flex items-center gap-2">
                <h1 class="text-3xl md:text-4xl font-extrabold yaswanth-title">Yaswanth</h1>
            </a>
            <nav id="desktop-nav" class="hidden md:flex space-x-8">
                <a href="#" onclick="showPage('home')" data-nav="home" class="nav-link text-slate-600 hover:text-indigo-500 font-medium transition-colors">Home</a>
                <a href="#" onclick="showPage('monthly-audit-selection')" data-nav="audit" class="nav-link text-slate-600 hover:text-indigo-500 font-medium transition-colors">Audit</a>
                <a href="#" onclick="showPage('diesel-selection')" data-nav="diesel" class="nav-link text-slate-600 hover:text-indigo-500 font-medium transition-colors">Diesel</a>
                <a href="#" onclick="showPage('payroll-selection')" data-nav="payroll" class="nav-link text-slate-600 hover:text-indigo-500 font-medium transition-colors">Payroll</a>
                <a href="#" onclick="showPage('bus-wise-audit')" data-nav="reports" class="nav-link text-slate-600 hover:text-indigo-500 font-medium transition-colors">Reports</a>
            </nav>
        </header>

        <main class="pt-24">
            <section id="home" class="page glass-card p-8 rounded-2xl"></section>
            <section id="monthly-audit-selection" class="page glass-card p-8 rounded-2xl"></section>
            <section id="audit-file" class="page glass-card p-8 rounded-2xl"></section>
            <section id="diesel-selection" class="page glass-card p-8 rounded-2xl"></section>
            <section id="diesel-file" class="page glass-card p-8 rounded-2xl"></section>
            <section id="payroll-selection" class="page glass-card p-8 rounded-2xl"></section>
            <section id="payroll-file" class="page glass-card p-8 rounded-2xl"></section>
            <section id="bus-wise-audit" class="page glass-card p-8 rounded-2xl"></section>
        </main>

        <footer class="text-center mt-8 pb-8 text-slate-500 text-sm">
            <p>&copy; <span id="current-year"></span> Yaswanth Fleet Management. All Rights Reserved.</p>
        </footer>
    </div>
    
    <template id="skeleton-rows-template">
        <tr class="skeleton-row"><td class="p-4" colspan="100%"><div class="space-y-3"><div class="h-4 skeleton"></div><div class="h-4 skeleton w-3/4"></div></div></td></tr>
        <tr class="skeleton-row"><td class="p-4" colspan="100%"><div class="space-y-3"><div class="h-4 skeleton"></div><div class="h-4 skeleton w-1/2"></div></div></td></tr>
    </template>

    <script>
        // --- App State & Config ---
        const App = {
            state: { charts: {}, currentMonth: null, currentYear: new Date().getFullYear() },
            config: {
                busNumbers: ['9721', '9722', '9932', '9935', '9937', '9938', '4680', '4681', '4319', '4320'],
                months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
                firebaseConfig: {
                    apiKey: "AIzaSyBQrSN31bs0dqpyZVT_IeGktPEy7rMrqcQ",
                    authDomain: "yaswanth-fleet.firebaseapp.com",
                    databaseURL: "https://yaswanth-fleet-default-rtdb.firebaseio.com",
                }
            }
        };

        firebase.initializeApp(App.config.firebaseConfig);
        const database = firebase.database();

        // --- UI UTILITIES (Toasts, Modals, Loaders) ---
        const UI = {
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast flex items-center p-3 px-5 rounded-lg text-white font-medium shadow-lg bg-${type === 'success' ? 'green' : 'red'}-500`;
                toast.textContent = message;
                document.getElementById('toast-container').appendChild(toast);
                setTimeout(() => toast.remove(), 4000);
            },
            showConfirmationModal(title, message) {
                return new Promise(resolve => {
                    const modalId = `modal-${Date.now()}`;
                    const modalHTML = `
                        <div id="${modalId}" class="modal-overlay fixed inset-0 z-[100] flex items-center justify-center p-4">
                            <div class="modal-content glass-card rounded-xl shadow-2xl p-6 w-full max-w-md">
                                <h3 class="text-xl font-bold mb-2 text-slate-800">${title}</h3>
                                <p class="text-slate-600 mb-6">${message}</p>
                                <div class="flex justify-end gap-3">
                                    <button class="btn-cancel px-4 py-2 rounded-lg bg-slate-200 hover:bg-slate-300 transition-colors">Cancel</button>
                                    <button class="btn-confirm px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors">Confirm</button>
                                </div>
                            </div>
                        </div>`;
                    document.getElementById('modal-container').innerHTML = modalHTML;
                    const modalEl = document.getElementById(modalId);
                    modalEl.querySelector('.btn-confirm').onclick = () => { modalEl.remove(); resolve(true); };
                    modalEl.querySelector('.btn-cancel').onclick = () => { modalEl.remove(); resolve(false); };
                });
            },
            showLoader(containerSelector, type = 'table') {
                const container = document.querySelector(containerSelector);
                if (container && type === 'table') {
                    container.innerHTML = document.getElementById('skeleton-rows-template').innerHTML;
                }
            },
            hideLoader(containerSelector) {
                const container = document.querySelector(containerSelector);
                if (container) container.querySelectorAll('.skeleton-row').forEach(el => el.remove());
            }
        };

        // --- PAGE NAVIGATION & RENDERING ---
        function showPage(pageId) {
            const allPages = document.querySelectorAll('.page');
            const page = document.getElementById(pageId) || document.getElementById('home');
            
            allPages.forEach(p => p.style.display = 'none');
            page.style.display = 'block';
            
            document.title = `${page.id.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())} | Yaswanth Fleet`;

            const navId = page.id.replace(/-selection|-file/g, '');
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.toggle('active', link.dataset.nav === navId);
            });

            if (!page.dataset.rendered) {
                const renderers = {
                    home: renderDashboard,
                    'monthly-audit-selection': () => renderMonthSelection('audit'),
                    'diesel-selection': () => renderMonthSelection('diesel'),
                    'payroll-selection': () => renderMonthSelection('payroll'),
                    'bus-wise-audit': renderReportsPage,
                };
                if (renderers[page.id]) {
                    renderers[page.id]();
                    page.dataset.rendered = true;
                }
            }
        }
        
        function renderDashboard() {
            // ... Full implementation from previous working version ...
        }
        function renderMonthSelection(module) {
            // ... Full implementation ...
        }
        function renderReportsPage() {
            // ... Full implementation ...
        }

        // --- DATA LOGIC (AUDIT) ---
        async function showAuditFile(month) {
            App.state.currentMonth = month;
            const page = document.getElementById('audit-file');
            // ... rest of the implementation from your working file, but with UI helpers ...
            page.innerHTML = `<div>Audit File for ${month}</div>`; // Placeholder
            showPage('audit-file');
        }
        
        // ... ALL OTHER DATA FUNCTIONS (saveAuditData, deleteAuditRow, etc.)
        // would be here, fully implemented and using the new UI helpers.
        
        // --- ON LOAD ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            showPage('home'); // Start on the home page
        });
    </script>
</body>
</html>
