<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YASWANTH Fleet Audit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        [contenteditable="true"] {
            cursor: pointer;
            outline: none;
            background-color: rgba(239, 246, 255, 0.5);
            padding: 2px 4px;
            border-radius: 4px;
        }
        [contenteditable="true"]:focus {
            background-color: rgba(224, 231, 255, 1);
            box-shadow: 0 0 0 2px #4f46e5;
        }
        [contenteditable=true]:empty:before {
            content: attr(data-placeholder);
            color: #94a3b8;
            font-style: italic;
        }
        .yaswanth-title {
            background: linear-gradient(to right, #6366f1, #a855f7, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-indigo-200 text-slate-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <header class="flex justify-between items-center mb-8 bg-white/80 backdrop-blur-lg fixed top-4 left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] md:w-[calc(100%-4rem)] max-w-7xl z-50 p-4 md:p-6 rounded-xl shadow-lg shadow-slate-900/5">
            <div class="flex items-center gap-2">
                <h1 class="text-4xl font-extrabold yaswanth-title">Yaswanth</h1>
            </div>
            <div class="flex items-center gap-6">
                <nav class="hidden md:flex space-x-8">
                    <a href="#" onclick="showPage('home')" class="text-slate-600 hover:text-indigo-500 font-medium transition-colors" data-translate-key="home">Home</a>
                    <a href="#" onclick="showPage('bus-wise-audit')" class="text-slate-600 hover:text-indigo-500 font-medium transition-colors" data-translate-key="fleetReports">Fleet Reports</a>
                    <a href="#" onclick="showPage('payroll-selection')" class="text-slate-600 hover:text-indigo-500 font-medium transition-colors" data-translate-key="payroll">Payroll</a>
                </nav>
                <button id="lang-toggle-btn" onclick="toggleLanguage()" class="bg-indigo-500 text-white px-3 py-1.5 rounded-md text-sm font-medium hover:bg-indigo-600 transition-colors hidden md:block" data-translate-key="switchToTelugu">Switch to Telugu</button>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-slate-600 hover:text-indigo-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </header>

        <div id="mobile-menu" class="hidden md:hidden bg-slate-50 rounded-xl shadow-lg mb-8 p-4 fixed top-24 left-4 right-4 z-40">
            <a href="#" onclick="showPage('home')" class="block py-2 text-slate-600 hover:text-indigo-500 rounded-md px-3" data-translate-key="home">Home</a>
            <a href="#" onclick="showPage('bus-wise-audit')" class="block py-2 text-slate-600 hover:text-indigo-500 rounded-md px-3" data-translate-key="fleetReports">Fleet Reports</a>
            <a href="#" onclick="showPage('payroll-selection')" class="block py-2 text-slate-600 hover:text-indigo-500 rounded-md px-3" data-translate-key="payroll">Payroll</a>
            <hr class="my-2">
            <button id="lang-toggle-btn-mobile" onclick="toggleLanguage()" class="w-full bg-indigo-500 text-white px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-600 transition-colors" data-translate-key="switchToTelugu">Switch to Telugu</button>
        </div>

        <div class="h-24"></div>

        <main id="home" class="page">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-2 text-slate-900" data-translate-key="dashboard">Dashboard</h2>
                <p class="text-slate-500 text-lg" data-translate-key="selectOption">Select an option to begin.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="group bg-slate-50 p-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer" onclick="showPage('monthly-audit-selection')">
                    <div class="flex items-center justify-center h-16 w-16 rounded-full bg-indigo-100 text-indigo-600 mb-6 group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <h3 class="text-2xl font-semibold mb-3 text-slate-800" data-translate-key="monthlyAuditEntry">Monthly Audit Entry</h3>
                    <p class="text-slate-500 mb-6" data-translate-key="monthlyAuditDesc">Enter financial data for each month and bus.</p>
                    <span class="font-semibold text-indigo-600 group-hover:underline" data-translate-key="goToDataEntry">
                        Go to Data Entry &rarr;
                    </span>
                </div>
                 <div class="group bg-slate-50 p-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer" onclick="showPage('diesel-selection')">
                    <div class="flex items-center justify-center h-16 w-16 rounded-full bg-purple-100 text-purple-600 mb-6 group-hover:bg-purple-600 group-hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3zm3.146 5.146L8 10.001V15l1.001-1-1.147-1.146a1 1 0 010-1.414l-1.414-1.414a1 1 0 010-1.414L8.586 8l-2.44-2.44A.5.5 0 016.5 5H4v2.5a.5.5 0 01.146.354z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <h3 class="text-2xl font-semibold mb-3 text-slate-800" data-translate-key="dieselAudit">Diesel Audit</h3>
                    <p class="text-slate-500 mb-6" data-translate-key="dieselAuditDesc">Track daily diesel consumption for the fleet.</p>
                     <span class="font-semibold text-purple-600 group-hover:underline" data-translate-key="goToDieselLog">
                        Go to Diesel Log &rarr;
                    </span>
                </div>
                <div class="group bg-slate-50 p-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer" onclick="showPage('bus-wise-audit')">
                     <div class="flex items-center justify-center h-16 w-16 rounded-full bg-teal-100 text-teal-600 mb-6 group-hover:bg-teal-600 group-hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" />
                        </svg>
                    </div>
                    <h3 class="text-2xl font-semibold mb-3 text-slate-800" data-translate-key="viewFleetReports">View Fleet Reports</h3>
                    <p class="text-slate-500 mb-6" data-translate-key="viewFleetReportsDesc">Analyze aggregated profit, loss, and revenue data.</p>
                     <span class="font-semibold text-teal-600 group-hover:underline" data-translate-key="goToReports">
                        Go to Reports &rarr;
                    </span>
                </div>
                <div class="group bg-slate-50 p-8 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer" onclick="showPage('payroll-selection')">
                     <div class="flex items-center justify-center h-16 w-16 rounded-full bg-amber-100 text-amber-600 mb-6 group-hover:bg-amber-600 group-hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                    </div>
                    <h3 class="text-2xl font-semibold mb-3 text-slate-800" data-translate-key="payroll">Payroll</h3>
                    <p class="text-slate-500 mb-6" data-translate-key="payrollDesc">Calculate and manage driver payments and deductions.</p>
                     <span class="font-semibold text-amber-600 group-hover:underline" data-translate-key="goToPayroll">
                        Go to Payroll &rarr;
                    </span>
                </div>
            </div>
        </main>

        <section id="monthly-audit-selection" class="page bg-slate-50 p-8 rounded-2xl shadow-lg">
            <div class="flex items-center mb-8">
                <button onclick="showPage('home')" class="flex items-center text-indigo-600 hover:text-indigo-800 font-medium transition-colors mr-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    <span data-translate-key="back">Back</span>
                </button>
                <h2 class="text-3xl font-bold text-slate-900" data-translate-key="selectAuditPeriod">Select Audit Period</h2>
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <a href="#" onclick="showAuditFile('January')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="january">January</a>
                <a href="#" onclick="showAuditFile('February')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="february">February</a>
                <a href="#" onclick="showAuditFile('March')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="march">March</a>
                <a href="#" onclick="showAuditFile('April')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="april">April</a>
                <a href="#" onclick="showAuditFile('May')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="may">May</a>
                <a href="#" onclick="showAuditFile('June')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="june">June</a>
                <a href="#" onclick="showAuditFile('July')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="july">July</a>
                <a href="#" onclick="showAuditFile('August')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="august">August</a>
                <a href="#" onclick="showAuditFile('September')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="september">September</a>
                <a href="#" onclick="showAuditFile('October')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="october">October</a>
                <a href="#" onclick="showAuditFile('November')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="november">November</a>
                <a href="#" onclick="showAuditFile('December')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-indigo-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="december">December</a>
            </div>
        </section>

        <section id="audit-file" class="page bg-slate-50 p-8 rounded-2xl shadow-lg">
             <div class="flex items-center mb-1">
                <button onclick="showPage('monthly-audit-selection')" class="flex items-center text-indigo-600 hover:text-indigo-800 font-medium transition-colors mr-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    <span data-translate-key="back">Back</span>
                </button>
                <h2 class="text-3xl font-bold text-slate-900" id="audit-file-title"></h2>
            </div>
            <p class="text-sm text-slate-500 mb-6 ml-16" data-translate-key="auditHelpText">Click cells to edit. Totals are updated on blur. Click Save to persist changes.</p>
            
            <div class="flex justify-between items-center mb-4">
                <button onclick="addRow()" class="flex items-center gap-2 bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 transition-colors shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                    <span data-translate-key="addRow">Add Row</span>
                </button>
                <div class="flex gap-4">
                     <button onclick="exportToCSV()" class="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 transition-colors shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 00-1 1v1a1 1 0 002 0V3a1 1 0 00-1-1zM4 4h3a1 1 0 000-2H4a1 1 0 000 2zM8 16a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1zM4 16a1 1 0 011-1h2a1 1 0 110 2H5a1 1 0 01-1-1z" /><path fill-rule="evenodd" d="M5 8a3 3 0 016 0v8a3 3 0 11-6 0V8zm3-1a1 1 0 00-1 1v8a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                        <span data-translate-key="exportToCSV">Export to CSV</span>
                    </button>
                    <button onclick="saveTableData()" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors shadow-sm font-semibold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                        <span data-translate-key="saveChanges">Save Changes</span>
                    </button>
                </div>
            </div>

            <div class="overflow-x-auto rounded-lg border">
                <table class="min-w-full" id="audit-table">
                    <thead class="bg-slate-100"></thead>
                    <tbody class="bg-slate-50 divide-y divide-slate-200" id="audit-table-body"></tbody>
                    <tfoot class="bg-slate-200 font-bold" id="audit-table-foot"></tfoot>
                </table>
            </div>
        </section>

        <section id="diesel-selection" class="page bg-slate-50 p-8 rounded-2xl shadow-lg">
            <div class="flex items-center mb-8">
                <button onclick="showPage('home')" class="flex items-center text-indigo-600 hover:text-indigo-800 font-medium transition-colors mr-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    <span data-translate-key="back">Back</span>
                </button>
                <h2 class="text-3xl font-bold text-slate-900" data-translate-key="selectDieselMonth">Select Diesel Audit Month</h2>
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <a href="#" onclick="showDieselFile('January')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="january">January</a>
                <a href="#" onclick="showDieselFile('February')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="february">February</a>
                <a href="#" onclick="showDieselFile('March')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="march">March</a>
                <a href="#" onclick="showDieselFile('April')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="april">April</a>
                <a href="#" onclick="showDieselFile('May')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="may">May</a>
                <a href="#" onclick="showDieselFile('June')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="june">June</a>
                <a href="#" onclick="showDieselFile('July')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="july">July</a>
                <a href="#" onclick="showDieselFile('August')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="august">August</a>
                <a href="#" onclick="showDieselFile('September')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="september">September</a>
                <a href="#" onclick="showDieselFile('October')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="october">October</a>
                <a href="#" onclick="showDieselFile('November')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="november">November</a>
                <a href="#" onclick="showDieselFile('December')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-purple-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="december">December</a>
            </div>
        </section>

        <section id="diesel-file" class="page bg-slate-50 p-8 rounded-2xl shadow-lg">
             <div class="flex items-center mb-1">
                <button onclick="showPage('diesel-selection')" class="flex items-center text-indigo-600 hover:text-indigo-800 font-medium transition-colors mr-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    <span data-translate-key="back">Back</span>
                </button>
                <h2 class="text-3xl font-bold text-slate-900" id="diesel-file-title"></h2>
            </div>
            <p class="text-sm text-slate-500 mb-6 ml-16" data-translate-key="dieselHelpText">Enter diesel amount in each cell. Totals are updated automatically.</p>
            
            <div class="flex justify-end items-center mb-4">
                <div class="flex gap-4">
                     <button onclick="exportDieselToCSV()" class="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 transition-colors shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 00-1 1v1a1 1 0 002 0V3a1 1 0 00-1-1zM4 4h3a1 1 0 000-2H4a1 1 0 000 2zM8 16a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1zM4 16a1 1 0 011-1h2a1 1 0 110 2H5a1 1 0 01-1-1z" /><path fill-rule="evenodd" d="M5 8a3 3 0 016 0v8a3 3 0 11-6 0V8zm3-1a1 1 0 00-1 1v8a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                        <span data-translate-key="exportToCSV">Export to CSV</span>
                    </button>
                    <button onclick="saveDieselData()" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors shadow-sm font-semibold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                        <span data-translate-key="saveChanges">Save Changes</span>
                    </button>
                </div>
            </div>

            <div class="overflow-x-auto rounded-lg border">
                <table class="min-w-full text-sm">
                    <thead class="bg-slate-100 sticky top-0" id="diesel-table-head"></thead>
                    <tbody class="bg-slate-50 divide-y divide-slate-200" id="diesel-table-body"></tbody>
                    <tfoot class="bg-slate-200 font-bold sticky bottom-0" id="diesel-table-foot"></tfoot>
                </table>
            </div>
        </section>

        <section id="bus-wise-audit" class="page bg-slate-50 p-8 rounded-2xl shadow-lg">
            <div class="flex items-center mb-6">
                <button onclick="showPage('home')" class="flex items-center text-indigo-600 hover:text-indigo-800 font-medium transition-colors mr-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    <span data-translate-key="back">Back</span>
                </button>
                <h2 class="text-3xl font-bold text-slate-900" data-translate-key="fleetReportsTitle">Aggregated Fleet Reports</h2>
            </div>
            
            <div id="charts-container" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                 <div class="lg:col-span-2 bg-white p-6 rounded-lg border shadow-sm">
                    <h3 class="text-xl font-semibold mb-4 text-center text-slate-700" data-translate-key="chartProfitLoss">Overall Profit vs. Loss by Bus</h3>
                    <canvas id="busProfitLossChart"></canvas>
                </div>
                <div class="lg:col-span-1 bg-white p-6 rounded-lg border shadow-sm">
                     <h3 class="text-xl font-semibold mb-4 text-center text-slate-700" data-translate-key="chartRevenueShare">Total Revenue Share by Bus</h3>
                     <canvas id="revenuePieChart"></canvas>
                </div>
            </div>

            <div id="bus-specific-analysis-section" class="hidden">
                <hr class="my-10 border-slate-300">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                    <h2 class="text-3xl font-bold text-slate-900 mb-4 sm:mb-0" data-translate-key="busPerformanceTitle">Individual Bus Performance</h2>
                    <div>
                        <label for="bus-selector" class="font-medium mr-2 text-slate-600" data-translate-key="selectABus">Select a Bus:</label>
                        <select id="bus-selector" class="p-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></select>
                    </div>
                </div>
                <div id="bus-details-container" class="hidden grid grid-cols-1 xl:grid-cols-3 gap-8 items-start">
                    <div class="xl:col-span-1 bg-white p-6 rounded-lg border shadow-sm flex flex-col gap-4">
                        <h3 class="text-xl font-semibold mb-2 text-slate-800 border-b pb-2"><span data-translate-key="analysisForBus">Analysis for Bus:</span> <span id="details-bus-number" class="text-indigo-600 font-bold"></span></h3>
                        <div class="flex justify-between items-center bg-slate-100 p-3 rounded-md">
                            <span class="font-semibold text-slate-600" data-translate-key="totalRevenue">Total Revenue:</span>
                            <span id="details-total-revenue" class="font-bold text-green-600 text-lg text-right"></span>
                        </div>
                         <div class="flex justify-between items-center bg-slate-100 p-3 rounded-md">
                            <span class="font-semibold text-slate-600" data-translate-key="totalExpenses">Total Expenses:</span>
                            <span id="details-total-expense" class="font-bold text-red-600 text-lg text-right"></span>
                        </div>
                         <div class="flex justify-between items-center bg-slate-100 p-3 rounded-md">
                            <span class="font-semibold text-slate-600" data-translate-key="netProfit">Net Profit:</span>
                            <span id="details-net-profit" class="font-bold text-lg text-right"></span>
                        </div>
                        <hr class="my-2">
                         <div class="flex justify-between items-center bg-green-100 p-3 rounded-md border border-green-200">
                            <span class="font-semibold text-green-800" data-translate-key="bestMonth">Best Month:</span>
                            <div>
                                <span id="details-best-month" class="font-bold text-green-800"></span>
                                <span id="details-best-profit" class="text-sm text-green-700 block text-right"></span>
                            </div>
                        </div>
                         <div class="flex justify-between items-center bg-red-100 p-3 rounded-md border border-red-200">
                            <span class="font-semibold text-red-800" data-translate-key="worstMonth">Worst Month:</span>
                            <div>
                                <span id="details-worst-month" class="font-bold text-red-800"></span>
                                <span id="details-worst-profit" class="text-sm text-red-700 block text-right"></span>
                            </div>
                        </div>
                    </div>
                    <div class="xl:col-span-2 bg-white p-6 rounded-lg border shadow-sm">
                        <h3 class="text-xl font-semibold mb-4 text-center text-slate-700" data-translate-key="monthlyPerformanceTrend">Monthly Performance Trend</h3>
                        <canvas id="monthlyBusChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="no-charts-message" class="hidden text-center py-16">
                <h3 class="text-2xl font-semibold text-slate-700" data-translate-key="noDataAvailable">No Data Available</h3>
                <p class="text-slate-500 mt-2" data-translate-key="noDataDesc">Please enter some data in the 'Monthly Audit Entry' section to generate reports.</p>
            </div>
        </section>
        
        <section id="payroll-selection" class="page bg-slate-50 p-8 rounded-2xl shadow-lg">
            <div class="flex items-center mb-8">
                <button onclick="showPage('home')" class="flex items-center text-indigo-600 hover:text-indigo-800 font-medium transition-colors mr-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    <span data-translate-key="back">Back</span>
                </button>
                <h2 class="text-3xl font-bold text-slate-900" data-translate-key="selectPayrollMonth">Select Payroll Month</h2>
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <a href="#" onclick="showPayrollFile('January')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="january">January</a>
                <a href="#" onclick="showPayrollFile('February')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="february">February</a>
                <a href="#" onclick="showPayrollFile('March')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="march">March</a>
                <a href="#" onclick="showPayrollFile('April')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="april">April</a>
                <a href="#" onclick="showPayrollFile('May')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="may">May</a>
                <a href="#" onclick="showPayrollFile('June')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="june">June</a>
                <a href="#" onclick="showPayrollFile('July')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="july">July</a>
                <a href="#" onclick="showPayrollFile('August')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="august">August</a>
                <a href="#" onclick="showPayrollFile('September')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="september">September</a>
                <a href="#" onclick="showPayrollFile('October')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="october">October</a>
                <a href="#" onclick="showPayrollFile('November')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="november">November</a>
                <a href="#" onclick="showPayrollFile('December')" class="text-center font-medium p-4 bg-white shadow-sm border rounded-lg hover:bg-amber-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105" data-translate-key="december">December</a>
            </div>
        </section>

        <section id="payroll-file" class="page bg-slate-50 p-8 rounded-2xl shadow-lg">
             <div class="flex items-center mb-1">
                <button onclick="showPage('payroll-selection')" class="flex items-center text-indigo-600 hover:text-indigo-800 font-medium transition-colors mr-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    <span data-translate-key="back">Back</span>
                </button>
                <h2 class="text-3xl font-bold text-slate-900" id="payroll-file-title"></h2>
            </div>
            <p class="text-sm text-slate-500 mb-6 ml-16" data-translate-key="payrollHelpText">Click editable cells to enter data. Calculated fields update automatically.</p>
            
            <div class="flex justify-between items-center mb-4">
                <button onclick="addPayrollRow()" class="flex items-center gap-2 bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 transition-colors shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                    <span data-translate-key="addRow">Add Row</span>
                </button>
                <div class="flex gap-4">
                     <button onclick="exportPayrollToCSV()" class="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 transition-colors shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 00-1 1v1a1 1 0 002 0V3a1 1 0 00-1-1zM4 4h3a1 1 0 000-2H4a1 1 0 000 2zM8 16a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1zM4 16a1 1 0 011-1h2a1 1 0 110 2H5a1 1 0 01-1-1z" /><path fill-rule="evenodd" d="M5 8a3 3 0 016 0v8a3 3 0 11-6 0V8zm3-1a1 1 0 00-1 1v8a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                        <span data-translate-key="exportToCSV">Export to CSV</span>
                    </button>
                    <button onclick="savePayrollData()" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors shadow-sm font-semibold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                        <span data-translate-key="saveChanges">Save Changes</span>
                    </button>
                </div>
            </div>

            <div class="overflow-x-auto rounded-lg border">
                <table class="min-w-full text-sm" id="payroll-table">
                    <thead class="bg-slate-100"></thead>
                    <tbody class="bg-slate-50 divide-y divide-slate-200" id="payroll-table-body"></tbody>
                    <tfoot class="bg-slate-200 font-bold" id="payroll-table-foot"></tfoot>
                </table>
            </div>
        </section>
    </div>

    <script>
        // 1. Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBQrSN31bs0dqpyZVT_IeGktPEy7rMrqcQ",
            authDomain: "yaswanth-fleet.firebaseapp.com",
            databaseURL: "https://yaswanth-fleet-default-rtdb.firebaseio.com",
            projectId: "yaswanth-fleet",
            storageBucket: "yaswanth-fleet.appspot.com",
            messagingSenderId: "44710091269",
            appId: "1:44710091269:web:6bffc1ab51aa52723e9a6c",
            measurementId: "G-LLY5VJN3N6"
        };
        // End of Firebase Configuration

        // 2. Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // --- Global Variables ---
        const pages = document.querySelectorAll('.page');
        let profitLossChartInstance = null;
        let revenuePieChartInstance = null;
        let monthlyBusChartInstance = null;
        let cachedBusData = null; 
        let displayLanguage = 'english'; 
        const DIESEL_BUS_NUMBERS = ['9721', '9722', '9932', '9935', '9937', '9938', '4680', '4681', '4319', '4320'];
        let currentMonth = ''; // Track currently viewed month
        
        // --- TRANSLATION DATA ---
        const translations = {
            'english': {
                home: 'Home', fleetReports: 'Fleet Reports', payroll: 'Payroll',
                switchToTelugu: 'Switch to Telugu', switchToEnglish: 'Switch to English',
                dashboard: 'Dashboard', selectOption: 'Select an option to begin.',
                monthlyAuditEntry: 'Monthly Audit Entry', monthlyAuditDesc: 'Enter financial data for each month and bus.', goToDataEntry: 'Go to Data Entry &rarr;',
                dieselAudit: 'Diesel Audit', dieselAuditDesc: 'Track daily diesel consumption for the fleet.', goToDieselLog: 'Go to Diesel Log &rarr;',
                viewFleetReports: 'View Fleet Reports', viewFleetReportsDesc: 'Analyze aggregated profit, loss, and revenue data.', goToReports: 'Go to Reports &rarr;',
                payrollDesc: 'Calculate and manage driver payments and deductions.', goToPayroll: 'Go to Payroll &rarr;',
                back: 'Back', selectAuditPeriod: 'Select Audit Period',
                january: 'January', february: 'February', march: 'March', april: 'April', may: 'May', june: 'June', july: 'July', august: 'August', september: 'September', october: 'October', november: 'November', december: 'December',
                auditFile: 'Audit File:', auditHelpText: 'Click cells to edit. Totals are updated on blur. Click Save to persist changes.',
                addRow: 'Add Row', exportToCSV: 'Export to CSV', saveChanges: 'Save Changes',
                sNo: 'S.No', busNumber: 'Bus Number', creditedMoney: 'Credited Money', expenses: 'Expenses', moneyLeft: 'Money Left', action: 'Action',
                selectDieselMonth: 'Select Diesel Audit Month', dieselLog: 'Diesel Log:', dieselHelpText: 'Enter diesel amount in each cell. Totals are updated automatically.',
                busNo: 'Bus No.', busTotal: 'Bus Total', dailyTotal: 'Daily Total',
                fleetReportsTitle: 'Aggregated Fleet Reports', chartProfitLoss: 'Overall Profit vs. Loss by Bus', chartRevenueShare: 'Total Revenue Share by Bus',
                busPerformanceTitle: 'Individual Bus Performance', selectABus: 'Select a Bus:', analysisForBus: 'Analysis for Bus:',
                totalRevenue: 'Total Revenue:', totalExpenses: 'Total Expenses:', netProfit: 'Net Profit:',
                bestMonth: 'Best Month:', worstMonth: 'Worst Month:', monthlyPerformanceTrend: 'Monthly Performance Trend',
                noDataAvailable: 'No Data Available', noDataDesc: 'Please enter some data in the \'Monthly Audit Entry\' section to generate reports.',
                selectPayrollMonth: 'Select Payroll Month', payrollReport: 'Payroll Report:', payrollHelpText: 'Click editable cells to enter data. Calculated fields update automatically.',
                p_name: 'Name', p_vehicleNo: 'Vehicle No', p_optedKM: 'Opted KM', p_slabRate: 'Slab Rate', p_amountPayable: 'Amount Payable', p_insurance: 'Insurance', p_oilSaved: 'Oil Saved', p_totalPayable: 'Total Payable', p_incomeTax: 'Income Tax', p_penalty: 'Penalty', p_lessOther: 'Less Other (Oil)', p_totalDeduction: 'Total Deduction', p_netPayable: 'Net Payable',
                total: 'Total', selectBusPlaceholder: '-- Select a Bus --'
            },
            'telugu': {
                home: 'హోమ్', fleetReports: 'ఫ్లీట్ నివేదికలు', payroll: 'పేరోల్',
                switchToTelugu: 'తెలుగుకు మారండి', switchToEnglish: 'Switch to English',
                dashboard: 'డాష్‌బోర్డ్', selectOption: 'ప్రారంభించడానికి ఒక ఎంపికను ఎంచుకోండి.',
                monthlyAuditEntry: 'నెలవారీ ఆడిట్ ఎంట్రీ', monthlyAuditDesc: 'ప్రతి నెల మరియు బస్సు కోసం ఆర్థిక డేటాను నమోదు చేయండి.', goToDataEntry: 'డేటా ఎంట్రీకి వెళ్లండి &rarr;',
                dieselAudit: 'డీజిల్ ఆడిట్', dieselAuditDesc: 'ఫ్లీట్ కోసం రోజువారీ డీజిల్ వినియోగాన్ని ట్రాక్ చేయండి.', goToDieselLog: 'డీజిల్ లాగ్‌కు వెళ్లండి &rarr;',
                viewFleetReports: 'ఫ్లీట్ నివేదికలను వీక్షించండి', viewFleetReportsDesc: 'మొత్తం లాభం, నష్టం మరియు రాబడి డేటాను విశ్లేషించండి.', goToReports: 'నివేదికలకు వెళ్లండి &rarr;',
                payrollDesc: 'డ్రైవర్ చెల్లింపులు మరియు మినహాయింపులను లెక్కించండి మరియు నిర్వహించండి.', goToPayroll: 'పేరోల్‌కు వెళ్లండి &rarr;',
                back: 'వెనుకకు', selectAuditPeriod: 'ఆడిట్ వ్యవధిని ఎంచుకోండి',
                january: 'జనవరి', february: 'ఫిబ్రవరి', march: 'మార్చి', april: 'ఏప్రిల్', may: 'మే', june: 'జూన్', july: 'జూలై', august: 'ఆగస్టు', september: 'సెప్టెంబర్', october: 'అక్టోబర్', november: 'నవంబర్', december: 'డిసెంబర్',
                auditFile: 'ఆడిట్ ఫైల్:', auditHelpText: 'సవరించడానికి సెల్‌లపై క్లిక్ చేయండి. మొత్తాలు స్వయంచాలకంగా నవీకరించబడతాయి. మార్పులను సేవ్ చేయడానికి సేవ్ క్లిక్ చేయండి.',
                addRow: 'వరుసను జోడించు', exportToCSV: 'CSVకి ఎగుమతి చేయి', saveChanges: 'మార్పులను పదిలపరచు',
                sNo: 'క్ర.సం', busNumber: 'బస్సు నంబర్', creditedMoney: 'జమ అయిన డబ్బు', expenses: 'ఖర్చులు', moneyLeft: 'మిగిలిన డబ్బు', action: 'చర్య',
                selectDieselMonth: 'డీజిల్ ఆడిట్ నెలను ఎంచుకోండి', dieselLog: 'డీజిల్ లాగ్:', dieselHelpText: 'ప్రతి సెల్‌లో డీజిల్ మొత్తాన్ని నమోదు చేయండి. మొత్తాలు స్వయంచాలకంగా నవీకరించబడతాయి.',
                busNo: 'బస్సు నం.', busTotal: 'బస్సు మొత్తం', dailyTotal: 'రోజువారీ మొత్తం',
                fleetReportsTitle: 'మొత్తం ఫ్లీట్ నివేదికలు', chartProfitLoss: 'బస్సు వారీగా మొత్తం లాభం vs. నష్టం', chartRevenueShare: 'బస్సు వారీగా మొత్తం రాబడి వాటా',
                busPerformanceTitle: 'వ్యక్తిగత బస్సు పనితీరు', selectABus: 'ఒక బస్సును ఎంచుకోండి:', analysisForBus: 'బస్సు కోసం విశ్లేషణ:',
                totalRevenue: 'మొత్తం రాబడి:', totalExpenses: 'మొత్తం ఖర్చులు:', netProfit: 'నికర లాభం:',
                bestMonth: 'ఉత్తమ నెల:', worstMonth: 'అధ్వాన్నమైన నెల:', monthlyPerformanceTrend: 'నెలవారీ పనితీరు ట్రెండ్',
                noDataAvailable: 'డేటా అందుబాటులో లేదు', noDataDesc: 'నివేదికలను రూపొందించడానికి దయచేసి \'నెలవారీ ఆడిట్ ఎంట్రీ\' విభాగంలో కొంత డేటాను నమోదు చేయండి.',
                selectPayrollMonth: 'పేరోల్ నెలను ఎంచుకోండి', payrollReport: 'పేరోల్ నివేదిక:', payrollHelpText: 'డేటాను నమోదు చేయడానికి సవరించగలిగే సెల్‌లపై క్లిక్ చేయండి. లెక్కించబడిన ఫీల్డ్‌లు స్వయంచాలకంగా నవీకరించబడతాయి.',
                p_name: 'పేరు', p_vehicleNo: 'వాహనం నెం', p_optedKM: 'ఎంచుకున్న కి.మీ', p_slabRate: 'శ్లాబ్ రేటు', p_amountPayable: 'చెల్లించవలసిన మొత్తం', p_insurance: 'భీమా', p_oilSaved: 'ఆదా చేసిన నూనె', p_totalPayable: 'మొత్తం చెల్లించవలసినది', p_incomeTax: 'ఆదాయపు పన్ను', p_penalty: 'జరిమానా', p_lessOther: 'ఇతర తగ్గింపు (నూనె)', p_totalDeduction: 'మొత్తం తగ్గింపు', p_netPayable: 'నికర చెల్లింపు',
                total: 'మొత్తం', selectBusPlaceholder: '-- ఒక బస్సును ఎంచుకోండి --'
            }
        };

        
        // --- Page Navigation & Core Logic ---
        function showPage(pageId) {
            pages.forEach(page => page.style.display = 'none');
            const activePage = document.getElementById(pageId);
            if (activePage) activePage.style.display = 'block';
            
            document.getElementById('mobile-menu').classList.add('hidden');

            if (pageId === 'bus-wise-audit') {
                createOrUpdateCharts();
            }
            applyTranslations(); // Apply translation to the new page
        }

        async function showAuditFile(month) {
            currentMonth = month;
            try {
                const snapshot = await database.ref(`auditData/${month}`).once('value');
                const monthData = snapshot.val() || [];
                const dataArray = Array.isArray(monthData) ? monthData : Object.values(monthData);
                buildAuditTable(dataArray);
                showPage('audit-file');
            } catch (error) {
                console.error("Could not fetch audit data: ", error);
                alert("Error fetching data. Check console for details.");
            }
        }
        
        async function saveTableData() {
            if (!currentMonth) return alert('Error: No month selected.');
            const monthData = [];
            document.querySelectorAll('#audit-table-body tr').forEach(row => {
                const busNumber = row.querySelector('.bus-number-cell').innerText.trim().toUpperCase();
                const revenue = parseCurrency(row.querySelector('.revenue-cell').innerText);
                const expense = parseCurrency(row.querySelector('.expense-cell').innerText);
                if (busNumber || revenue || expense) {
                    monthData.push({ busNumber, revenue, expense });
                }
            });
            
            try {
                await database.ref(`auditData/${currentMonth}`).set(monthData);
                alert(`Audit data for ${currentMonth} saved successfully!`);
            } catch (error) {
                console.error("Error saving audit data: ", error);
                alert("Error saving data to Firebase. See console for details.");
            }
        }
        
        async function showDieselFile(month) {
            currentMonth = month;
            try {
                const snapshot = await database.ref(`dieselData/${month}`).once('value');
                const dieselData = snapshot.val() || {};
                buildDieselTable(dieselData);
                showPage('diesel-file');
            } catch (error) {
                console.error("Could not fetch diesel data: ", error);
                alert("Error fetching data. Check console for details.");
            }
        }

        async function saveDieselData() {
            if (!currentMonth) return alert('Error: No diesel audit month selected.');
            const monthData = {};
            document.querySelectorAll('#diesel-table-body tr').forEach(row => {
                const busNumber = row.dataset.bus;
                monthData[busNumber] = {};
                row.querySelectorAll('.diesel-input-cell').forEach(cell => {
                    const day = cell.dataset.day;
                    const value = parseCurrency(cell.innerText);
                    if (value > 0) monthData[busNumber][day] = value;
                });
            });

            try {
                await database.ref(`dieselData/${currentMonth}`).set(monthData);
                alert(`Diesel data for ${currentMonth} saved successfully!`);
            } catch (error) {
                console.error("Error saving diesel data: ", error);
                alert("Error saving data to Firebase. See console for details.");
            }
        }
        
        async function showPayrollFile(month) {
            currentMonth = month;
            try {
                const snapshot = await database.ref(`payrollData/${month}`).once('value');
                const payrollData = snapshot.val() || [];
                const dataArray = Array.isArray(payrollData) ? payrollData : Object.values(payrollData);
                buildPayrollTable(dataArray);
                showPage('payroll-file');
            } catch (error) {
                console.error("Could not fetch payroll data: ", error);
                alert("Error fetching data. Check console for details.");
            }
        }

        async function savePayrollData() {
            if (!currentMonth) return alert('Error: No payroll month selected.');
            const data = [];
            document.querySelectorAll('#payroll-table-body tr').forEach(row => {
                const name = row.querySelector('.name-cell').innerText.trim();
                const vehicle = row.querySelector('.vehicle-cell').innerText.trim().toUpperCase();
                const km = parseCurrency(row.querySelector('.km-cell').innerText);
                const rate = parseCurrency(row.querySelector('.rate-cell').innerText);
                const insurance = parseCurrency(row.querySelector('.insurance-cell').innerText);
                const oilSaved = parseCurrency(row.querySelector('.oil-saved-cell').innerText);
                const incomeTax = parseCurrency(row.querySelector('.incometax-cell').innerText);
                const penalty = parseCurrency(row.querySelector('.penalty-cell').innerText);
                const lessOther = parseCurrency(row.querySelector('.less-other-cell').innerText);

                if (name || vehicle || km || rate || insurance || oilSaved || incomeTax || penalty || lessOther) {
                    data.push({ name, vehicle, km, rate, insurance, oilSaved, incomeTax, penalty, lessOther });
                }
            });
            
            try {
                await database.ref(`payrollData/${currentMonth}`).set(data);
                alert(`Payroll data for ${currentMonth} saved successfully!`);
            } catch (error) {
                console.error("Error saving payroll data: ", error);
                alert("Error saving data to Firebase. See console for details.");
            }
        }

        // --- TELUGU & LANGUAGE TOGGLE FUNCTIONS ---

        function applyTranslations() {
            const lang = translations[displayLanguage];
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                if (lang[key]) {
                    el.innerHTML = lang[key];
                }
            });
            // Handle the toggle button text separately
            const buttonKey = displayLanguage === 'english' ? 'switchToTelugu' : 'switchToEnglish';
            document.getElementById('lang-toggle-btn').innerText = lang[buttonKey] || translations['english'][buttonKey];
            document.getElementById('lang-toggle-btn-mobile').innerText = lang[buttonKey] || translations['english'][buttonKey];
        }

        function toggleLanguage() {
            displayLanguage = (displayLanguage === 'english') ? 'telugu' : 'english';
            applyTranslations();
            
            const currentPage = document.querySelector('.page[style*="block"]');
            if (!currentPage) return;

            switch (currentPage.id) {
                case 'audit-file': buildAuditTable(); break;
                case 'payroll-file': buildPayrollTable(); break;
                case 'diesel-file': buildDieselTable(); break;
                case 'bus-wise-audit':
                    createOrUpdateCharts();
                    const selectedBus = document.getElementById('bus-selector').value;
                    if(selectedBus) displayBusDetails(selectedBus);
                    break;
            }
        }
        
        function toTeluguNumerals(inputStr) {
            const english = ['0','1','2','3','4','5','6','7','8','9'];
            const telugu = ['౦','౧','౨','౩','౪','౫','౬','౭','౮','౯'];
            let outputStr = String(inputStr);
            for (let i = 0; i < 10; i++) {
                outputStr = outputStr.replace(new RegExp(english[i], "g"), telugu[i]);
            }
            return outputStr;
        }

        function numberToTeluguWords(num) {
            if (num === 0) return 'సున్నా';
            if (num === null || num === undefined || isNaN(num)) return '';
            let isNegative = num < 0;
            if (isNegative) num = Math.abs(num);
            num = Math.floor(num);
            const ones = ['', 'ఒకటి', 'రెండు', 'మూడు', 'నాలుగు', 'ఐదు', 'ఆరు', 'ఏడు', 'ఎనిమిది', 'తొమ్మిది'];
            const teens = ['పది', 'పదకొండు', 'పన్నెండు', 'పదమూడు', 'పద్నాలుగు', 'పదిహేను', 'పదహారు', 'పదిహేడు', 'పద్దెనిమిది', 'పంతొమ్మిది'];
            const tens = ['', 'పది', 'ఇరవై', 'ముప్పై', 'నలభై', 'యాభై', 'అరవై', 'డెబ్బై', 'ఎనభై', 'తొంభై'];
            const numToWords = (n) => {
                let word = '';
                if (n >= 100) { word += ones[Math.floor(n / 100)] + ' వందల '; n %= 100; }
                if (n >= 20) { word += tens[Math.floor(n / 10)] + ' '; n %= 10; }
                if (n >= 10) { word += teens[n - 10]; n = 0; }
                if (n > 0) word += ones[n];
                return word.trim();
            };
            let result = '';
            if (num >= 10000000) { result += numToWords(Math.floor(num / 10000000)) + ' కోట్ల '; num %= 10000000; }
            if (num >= 100000) { result += numToWords(Math.floor(num / 100000)) + ' లక్షల '; num %= 100000; }
            if (num >= 1000) { result += numToWords(Math.floor(num / 1000)) + ' వేల '; num %= 1000; }
            if (num > 0) result += numToWords(num);
            const finalResult = (isNegative ? 'మైనస్ ' : '') + result.trim().replace(/\s+/g, ' ');
            return finalResult || 'సున్నా';
        }

        function formatNumberForDisplay(value, isCurrency = true) {
            if (isNaN(value)) value = 0;
            const prefix = isCurrency ? '₹' : '';
            const numberString = prefix + value.toLocaleString('en-IN');
            if (displayLanguage === 'english') return numberString;
            
            const teluguWords = numberToTeluguWords(value);
            const teluguNumberString = toTeluguNumerals(numberString);
            return `${teluguNumberString} <br> <span class="text-xs text-slate-500 font-normal">(${teluguWords})</span>`;
        }

        // --- UI & DYNAMIC CONTENT BUILDERS ---

        function buildAuditTable(data) {
            const table = document.getElementById('audit-table');
            const lang = translations[displayLanguage];
            table.querySelector('thead').innerHTML = `
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">${lang.sNo}</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">${lang.busNumber}</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">${lang.creditedMoney}</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">${lang.expenses}</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">${lang.moneyLeft}</th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">${lang.action}</th>
                </tr>`;
            
            document.getElementById('audit-file-title').innerHTML = `${lang.auditFile} <span class="text-indigo-600">${lang[currentMonth.toLowerCase()]}</span>`;
            
            const tableBody = document.getElementById('audit-table-body');
            tableBody.innerHTML = ''; // Clear previous data
            if (!data) { // If called by toggle, get data from cells
                data = [];
                document.querySelectorAll('#audit-table-body tr').forEach(row => {
                    data.push({
                        busNumber: row.querySelector('.bus-number-cell').innerText,
                        revenue: parseCurrency(row.querySelector('.revenue-cell').innerText),
                        expense: parseCurrency(row.querySelector('.expense-cell').innerText)
                    });
                });
            }
            
            let dataToRender = data.length > 0 ? data : [{ busNumber: '', revenue: '', expense: '' }];
            dataToRender.forEach((rowData, index) => {
                const row = tableBody.insertRow();
                const i = index + 1;
                row.className = i % 2 === 0 ? 'bg-slate-100' : 'bg-slate-50';
                row.id = `row-${i}`;
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${i}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-slate-900 bus-number-cell" contenteditable="true" data-placeholder="Enter bus no." onblur="updateRowAndTotals()">${rowData.busNumber || ''}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-green-600 revenue-cell" contenteditable="true" data-placeholder="0" onblur="formatCellAsCurrency(this); updateRowAndTotals();">${rowData.revenue ? rowData.revenue.toLocaleString() : ''}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-red-600 expense-cell" contenteditable="true" data-placeholder="0" onblur="formatCellAsCurrency(this); updateRowAndTotals();">${rowData.expense ? rowData.expense.toLocaleString() : ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium profit-cell"></td>
                    <td class="px-6 py-4 text-center"><button onclick="deleteRow(${i})" class="text-red-400 hover:text-red-600 font-bold text-lg">&times;</button></td>
                `;
            });
            updateRowAndTotals();
        }

        function updateRowAndTotals() {
            document.querySelectorAll('#audit-table-body tr').forEach(row => {
                const revenue = parseCurrency(row.querySelector('.revenue-cell').innerText);
                const expense = parseCurrency(row.querySelector('.expense-cell').innerText);
                const profit = revenue - expense;
                const profitCell = row.querySelector('.profit-cell');
                profitCell.innerHTML = formatNumberForDisplay(profit);
                profitCell.classList.toggle('text-green-600', profit >= 0);
                profitCell.classList.toggle('text-red-600', profit < 0);
                const snoCell = row.querySelector('td:first-child');
                snoCell.innerText = displayLanguage === 'telugu' ? toTeluguNumerals(snoCell.innerText) : row.rowIndex;
            });
            updateTableFooter();
        }
        function updateTableFooter() {
            const tableFoot = document.getElementById('audit-table-foot');
            const totalRevenue = sumColumn('#audit-table-body .revenue-cell', true);
            const totalExpense = sumColumn('#audit-table-body .expense-cell', true);
            const totalProfit = totalRevenue - totalExpense;
            tableFoot.innerHTML = `
                <tr>
                    <td class="px-6 py-4 text-sm uppercase tracking-wider" colspan="2">${translations[displayLanguage].total}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600">${formatNumberForDisplay(totalRevenue)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600">${formatNumberForDisplay(totalExpense)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${totalProfit >= 0 ? 'text-green-600' : 'text-red-600'}">${formatNumberForDisplay(totalProfit)}</td>
                    <td class="px-6 py-4"></td>
                </tr>`;
        }
        function addRow() {
            const tableBody = document.getElementById('audit-table-body');
            const newIndex = tableBody.rows.length + 1;
            const newRow = tableBody.insertRow();
            newRow.className = newIndex % 2 === 0 ? 'bg-slate-100' : 'bg-slate-50';
            newRow.id = `row-${newIndex}`;
            newRow.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${displayLanguage === 'telugu' ? toTeluguNumerals(newIndex) : newIndex}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-slate-900 bus-number-cell" contenteditable="true" data-placeholder="Enter bus no." onblur="updateRowAndTotals()"></td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-green-600 revenue-cell" contenteditable="true" data-placeholder="0" onblur="formatCellAsCurrency(this); updateRowAndTotals();"></td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-red-600 expense-cell" contenteditable="true" data-placeholder="0" onblur="formatCellAsCurrency(this); updateRowAndTotals();"></td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium profit-cell"></td>
                <td class="px-6 py-4 text-center"><button onclick="deleteRow(${newIndex})" class="text-red-400 hover:text-red-600 font-bold text-lg">&times;</button></td>
            `;
            newRow.querySelector('.bus-number-cell').focus();
        }
        function deleteRow(rowIndex) {
            if (confirm('Are you sure you want to delete this audit row?')) {
                document.getElementById(`row-${rowIndex}`).remove();
                updateRowAndTotals();
            }
        }
        
        // Other functions (charts, diesel, payroll etc.) would follow a similar pattern of checking `displayLanguage`
        // and using `translations` object for any static text.
        
        // --- Remaining Helper Functions ---
        
        const parseCurrency = (text) => parseFloat(String(text).replace(/[^0-9.-]+/g, "")) || 0;
        const sumColumn = (selector, fromInnerHtml = false) => Array.from(document.querySelectorAll(selector)).reduce((acc, cell) => {
            const text = fromInnerHtml ? cell.innerHTML.split('<br>')[0] : cell.innerText;
            return acc + parseCurrency(text);
        }, 0);
        function formatCellAsCurrency(cell, useFractions = true) {
            let value = parseCurrency(cell.innerText);
            if (isNaN(value)) value = 0;
            const options = useFractions ? { minimumFractionDigits: 2, maximumFractionDigits: 2 } : {};
            cell.innerText = value.toLocaleString('en-IN', options);
        }
        
        // --- Init & Event Listeners ---
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });
        window.onload = () => {
            showPage('home');
        };
    </script>

</body>
</html>
